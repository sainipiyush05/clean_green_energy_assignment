<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Portfolio ‚Äî Piyush Saini</title>
<meta name="description" content="FT-IV Portfolio ‚Äî Clean & Green Energy. AIM ‚Üí Flow Chart ‚Üí Solution, real-world cases and references. Clean & Green UI with light/dark theme."/>
<style>
  /* ---------- CLEAN & GREEN THEME (CSS variables) ---------- */
  :root{
    /* Light (Clean & Green) */
    --bg:#f5fbf7;            /* paper-green */
    --panel:#ffffff;         /* cards & sidebar */
    --text:#0b1f16;          /* deep forest */
    --muted:#4b6b57;         /* soft green-gray */
    --border:#cfe6d9;        /* pale mint border */
    --shadow:0 10px 28px rgba(8,32,24,.08);

    /* Accents */
    --accent:#16a34a;        /* green-600 */
    --accent-2:#22c55e;      /* green-500 */
    --accent-3:#86efac;      /* green-300 */
    --accent-ink:#07391f;    /* dark ink on gradient buttons */
    --link:#15803d;          /* green-700 */

    /* Buttons / inputs */
    --btn-panel:#eff8f1;
    --btn-text:#0b1f16;
    --btn-border:#cfe6d9;

    /* Diagram vars */
    --svg-box:#e8f7ee;       /* step background */
    --svg-stroke:#78c5a0;    /* box outline */
    --svg-text:#0b1f16;
    --svg-lane:#bdebd2;      /* center lane */
    --svg-arrow:#22c55e;     /* connectors */

    /* Eco scene */
    --eco-hill-1:#d4f3e2;
    --eco-hill-2:#c3ecd7;
    --eco-tree:#2f855a;
    --eco-tree-top:#34d399;
    --eco-sun:#fde68a;
    --eco-turbine:#567a67;
    --eco-scene-opacity:.35;
    --eco-leaf:#34d399;

    --danger:#ef4444;
    --ring:0 0 0 2px color-mix(in oklab, var(--accent) 30%, transparent) inset;
  }
  [data-theme="dark"]{
    /* Dark (Evergreen) */
    --bg:#0b1612;            /* near-forest */
    --panel:#0f1e18;         /* deep pine */
    --text:#e5ffee;
    --muted:#a2cbb5;
    --border:#214736;        /* pine border */
    --shadow:0 16px 34px rgba(0,0,0,.35);

    --accent:#22c55e;
    --accent-2:#86efac;
    --accent-3:#4ade80;
    --accent-ink:#052012;
    --link:#86efac;

    --btn-panel:#0f231a;
    --btn-text:#dff5e8;
    --btn-border:#285a44;

    --svg-box:#0f2a1f;
    --svg-stroke:#2b8e5a;
    --svg-text:#e5ffee;
    --svg-lane:#1d3e2f;
    --svg-arrow:#86efac;

    --eco-hill-1:#0f442f;
    --eco-hill-2:#0b3324;
    --eco-tree:#75f0cf;
    --eco-tree-top:#22c55e;
    --eco-sun:#fde68a;
    --eco-turbine:#a7c3b5;
    --eco-scene-opacity:.22;
    --eco-leaf:#22c55e;

    --ring:0 0 0 2px color-mix(in oklab, var(--accent) 40%, transparent) inset;
  }

  /* ---------- BASE LAYOUT ---------- */
  *{box-sizing:border-box}
  html{scroll-behavior:smooth}
  html,body{height:100%}
  body{
    margin:0;display:grid;grid-template-columns:300px 1fr;
    background:linear-gradient(180deg, color-mix(in oklab, var(--bg) 85%, white), var(--bg));
    color:var(--text);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;line-height:1.6;
  }

  /* ---------- ECO BACKGROUND SCENE ---------- */
  .eco-scene{position:fixed; inset:auto 0 0 300px; height:170px; pointer-events:none; z-index:0; opacity:var(--eco-scene-opacity)}
  @media (max-width:980px){.eco-scene{left:0}}
  .eco-sun{filter:drop-shadow(0 0 6px rgba(253,230,138,.8))}
  .turbine .blade{transform-origin:50% 50%; animation:spin 4.6s linear infinite}
  .turbine.fast .blade{animation-duration:2.8s}
  @keyframes spin{to{transform:rotate(360deg)}}
  .eco-leaf{position:fixed;width:10px;height:10px;border-radius:2px 50% 50% 2px/50% 50% 2px 2px;background:var(--eco-leaf);opacity:.22;transform:rotate(40deg);filter:blur(.2px);pointer-events:none;z-index:0;animation:leafFloat var(--dur,16s) linear infinite}
  .eco-leaf:nth-child(1){left:22%;bottom:140px;--dur:14s}
  .eco-leaf:nth-child(2){left:35%;bottom:120px;--dur:18s}
  .eco-leaf:nth-child(3){left:70%;bottom:150px;--dur:16s}
  .eco-leaf:nth-child(4){left:55%;bottom:130px;--dur:20s}
  @keyframes leafFloat{0%{transform:translateY(0) rotate(30deg)}50%{transform:translateY(-40px) rotate(60deg)}100%{transform:translateY(0) rotate(30deg)}}

  /* ---------- SIDEBAR ---------- */
  aside{
    background:var(--panel);
    border-right:1px solid var(--border);
    padding:22px 16px;position:sticky;top:0;height:100vh;overflow:auto;
    box-shadow:var(--shadow); z-index:2
  }
  .brand{display:grid;gap:8px;margin-bottom:16px}
  .badge{
    display:inline-flex;align-items:center;gap:8px;
    padding:6px 12px;border:1px solid var(--border);border-radius:999px;
    background:linear-gradient(90deg, color-mix(in oklab,#fff 70%, var(--accent-3)), color-mix(in oklab,#fff 70%, var(--accent-2)));
    color:var(--accent-ink); font-size:12px; letter-spacing:.3px
  }
  .brand h1{font-size:20px;margin:0}
  .meta{margin-top:6px;font-size:13px;color:var(--muted)}
  .row{display:flex;gap:8px;flex-wrap:wrap}

  .menu-toggle{display:none;margin:10px 0 0;font-size:14px;border:1px solid var(--btn-border);
    background:var(--btn-panel);color:var(--btn-text);padding:8px 10px;border-radius:10px;cursor:pointer}
  nav{margin-top:12px;display:grid;gap:8px}
  nav a, .btn{
    display:flex;align-items:center;gap:8px;text-decoration:none;
    color:var(--text);padding:10px 12px;border-radius:12px;
    border:1px solid var(--btn-border);background:var(--btn-panel);cursor:pointer;
    transition:transform .05s ease
  }
  nav a:hover, .btn:hover{filter:brightness(0.98)}
  nav a:active, .btn:active{transform:translateY(1px)}
  nav a.active{border-color:var(--accent);box-shadow:var(--ring)}
  .btn-accent{
    border-color:transparent;
    background:linear-gradient(90deg, var(--accent) , var(--accent-2));
    color:var(--accent-ink)
  }
  .btn-icon{gap:6px}
  .theme-chip{
    display:flex;align-items:center;gap:8px;margin-top:10px;
    border:1px solid var(--btn-border);background:var(--btn-panel);
    padding:8px 10px;border-radius:12px;cursor:pointer;font-size:14px;color:var(--btn-text)
  }

  /* ---------- MAIN ---------- */
  main{padding:26px 26px 120px;max-width:1200px;width:100%;margin:0 auto; z-index:1}
  header.card,section.card{
    background:var(--panel);border:1px solid var(--border);
    border-radius:18px;padding:20px;margin-bottom:20px;box-shadow:var(--shadow)
  }
  header.card h2{margin:0 0 8px;font-size:24px}
  header.card p{margin:6px 0 0;color:var(--muted)}
  .lead{color:var(--muted)}
  h3{margin:0 0 12px;font-size:20px}
  /* section title underline */
  h3::after{
    content:"";display:block;width:68px;height:3px;border-radius:2px;
    background:linear-gradient(90deg,var(--accent),var(--accent-2));
    margin-top:6px
  }

  .grid{display:grid;gap:16px;grid-template-columns:1fr 1fr}
  .diagram{
    background:color-mix(in oklab, var(--panel) 85%, var(--bg));
    border:1px dashed var(--border);border-radius:16px;padding:12px;display:grid;place-items:center;overflow:auto
  }
  .explain{
    background:color-mix(in oklab, var(--panel) 85%, var(--bg));
    border:1px solid var(--border);border-radius:16px;padding:14px 16px
  }
  .explain h4{margin:0 0 8px;font-size:16px;color:var(--text)}
  .explain ul{margin:0 0 10px 18px}
  .explain li{margin:4px 0}
  .explain a{color:var(--link);text-decoration:underline dotted}

  .footer{text-align:center;color:var(--muted);margin-top:36px;font-size:13px}
  .top-btn{
    position:fixed;right:18px;bottom:18px;border-radius:999px;border:1px solid var(--btn-border);
    background:var(--btn-panel);color:var(--btn-text);
    padding:10px 12px;cursor:pointer;box-shadow:var(--shadow);display:none; z-index:3
  }
  .top-btn.show{display:block}
  .stamp{font-size:12px;color:var(--muted);margin-top:6px}
  :target{scroll-margin-top:14px}

  /* ---------- Dashboard ---------- */
  .dash-grid{display:grid;grid-template-columns:repeat(3,minmax(240px,1fr));gap:14px}
  .kpi{
    border:1px solid var(--border);border-radius:16px;padding:14px;background:var(--panel);
    display:grid;gap:6px
  }
  .kpi b{display:flex;align-items:center;gap:8px}
  .kpi b::before{content:"üåø"}
  .cards{display:grid;grid-template-columns:repeat(3,minmax(260px,1fr));gap:14px;margin-top:10px}
  .card-mini{
    border:1px solid var(--border);border-radius:16px;padding:14px;background:var(--panel);
    display:grid;gap:10px
  }
  .tag{font-size:12px;border:1px solid var(--border);padding:2px 8px;border-radius:999px;color:var(--muted);background:var(--btn-panel)}

  /* Modal */
  dialog{border:none;border-radius:16px;padding:0;background:transparent}
  .modal{
    background:var(--panel);border:1px solid var(--border);border-radius:16px;
    min-width:min(780px,95vw);box-shadow:var(--shadow);color:var(--text)
  }
  .modal header{padding:14px 16px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
  .modal .content{padding:16px}
  .modal .grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .field{display:grid;gap:6px;margin-bottom:10px}
  .field textarea{min-height:90px}
  input,textarea{
    width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--btn-border);
    background:var(--btn-panel);color:var(--text)
  }
  input:focus,textarea:focus{outline:none; box-shadow:var(--ring)}
  label{font-size:13px;color:var(--muted)}
  .modal footer{display:flex;gap:10px;justify-content:flex-end;padding:12px 16px;border-top:1px solid var(--border)}
  .btn-small{padding:6px 10px;border-radius:10px;border:1px solid var(--btn-border);background:var(--btn-panel);color:var(--btn-text);cursor:pointer}
  .btn-small:hover{filter:brightness(0.98)}

  /* Visibility & Responsive */
  .hidden{display:none}
  @media (max-width:1080px){.dash-grid{grid-template-columns:repeat(2,minmax(220px,1fr))}.cards{grid-template-columns:repeat(2,minmax(240px,1fr))}}
  @media (max-width:980px){
    body{grid-template-columns:1fr}
    aside{position:static;height:auto}
    .menu-toggle{display:inline-block}
    nav[aria-label="Activities"].collapsed{display:none}
    .grid{grid-template-columns:1fr}
    main{padding:18px}
    .dash-grid,.cards{grid-template-columns:1fr}
    .modal .grid2{grid-template-columns:1fr}
  }
  @media print{
    body{display:block;background:#fff;color:#000}
    aside{display:none}
    main{padding:0}
    header.card,section.card{box-shadow:none;border:1px solid #ccc}
    .diagram{border-color:#bbb}
    .top-btn{display:none!important}
    a[href^="#"]::after{content:" (" attr(href) ")";font-size:10px;color:#555}
  }
</style>
</head>
<body>
  <!-- subtle floating eco leaves -->
  <div class="eco-leaf"></div><div class="eco-leaf"></div><div class="eco-leaf"></div><div class="eco-leaf"></div>

  <aside>
    <div class="brand">
      <span class="badge">Clean & Green ‚Ä¢ Portfolio</span>
      <h1>Clean and Green Energy</h1>
      <div class="meta" role="contentinfo">
        <div><strong>Name:</strong> Piyush Saini</div>
        <div><strong>Reg. No.:</strong> RA2311026010105</div>
        <div><strong>Course:</strong> Clean and Green Energy</div>
        <div class="stamp">Last updated: <span id="lastUpdated">‚Äî</span></div>
      </div>
    </div>

    <button class="menu-toggle" aria-expanded="false" aria-controls="menu">‚ò∞ Menu</button>

    <nav id="menu" aria-label="Activities" class="collapsed" style="margin-top:12px"></nav>

    <div class="row" style="margin-top:12px">
      <button class="btn btn-accent btn-icon" id="openAddSide">Ôºã Add Activity</button>
      <button class="theme-chip" id="themeToggle" title="Toggle theme">üåû Light</button>
    </div>

    <div class="meta" style="margin-top:18px">
      <span class="tag">Clarity</span>
      <span class="tag">Neatness</span>
      <span class="tag">Originality</span>
      <span class="tag">Diagrams</span>
    </div>
  </aside>

  <main>
    <!-- DASHBOARD -->
    <section id="dashboard" class="card" aria-labelledby="dash-title">
      <h2 id="dash-title">Dashboard</h2>
      <p class="lead">Click an activity to open it (only one shows at a time). Format: <b>AIM ‚Üí FLOW CHART ‚Üí SOLUTION</b> with <b>Real-World Case</b> and <b>References</b>. Use <b>Ôºã Add Activity</b> to add more projects.</p>

      <div class="dash-grid" id="kpis"></div>

      <div class="row" style="margin:10px 0 6px">
        <button class="btn btn-accent" id="openAddDash">Ôºã Add Activity</button>
      </div>

      <div class="cards" id="cards"></div>
    </section>

    <!-- ACTIVITIES -->
    <div id="activities"></div>

    <div class="footer">
      ¬© 2025 ‚Ä¢ Portfolio by Piyush Saini ‚Ä¢ Course: Clean and Green Energy ‚Ä¢ Reg No: RA2311026010105
    </div>
  </main>

  <!-- ECO SCENE -->
  <svg class="eco-scene" viewBox="0 0 1200 200" preserveAspectRatio="none" aria-hidden="true">
    <circle class="eco-sun" cx="1080" cy="40" r="18" fill="var(--eco-sun)" />
    <path d="M0,140 C120,110 220,130 360,120 C540,110 640,150 820,140 C980,132 1100,150 1200,142 L1200,200 L0,200 Z" fill="var(--eco-hill-1)"/>
    <path d="M0,150 C140,130 300,150 460,140 C620,132 820,170 1000,160 C1080,154 1150,170 1200,165 L1200,200 L0,200 Z" fill="var(--eco-hill-2)"/>
    <g fill="var(--eco-tree-top)" stroke="var(--eco-tree)" stroke-width="1">
      <g transform="translate(180,115)"><polygon points="0,0 14,-20 28,0" /><polygon points="2,-8 14,-30 26,-8" /><rect x="11" y="0" width="6" height="10" fill="var(--eco-tree)"/></g>
      <g transform="translate(260,125) scale(1.1)"><polygon points="0,0 14,-20 28,0" /><polygon points="2,-8 14,-30 26,-8" /><rect x="11" y="0" width="6" height="10" fill="var(--eco-tree)"/></g>
      <g transform="translate(680,120) scale(1.2)"><polygon points="0,0 14,-20 28,0" /><polygon points="2,-8 14,-30 26,-8" /><rect x="11" y="0" width="6" height="10" fill="var(--eco-tree)"/></g>
      <g transform="translate(980,130) scale(1.05)"><polygon points="0,0 14,-20 28,0" /><polygon points="2,-8 14,-30 26,-8" /><rect x="11" y="0" width="6" height="10" fill="var(--eco-tree)"/></g>
    </g>
    <g class="turbine" transform="translate(470,92)">
      <rect x="14.5" y="0" width="3" height="45" fill="var(--eco-turbine)"/>
      <g class="blade" transform="translate(16,0)">
        <polygon points="0,-18 2,-2 -2,-2" fill="var(--eco-turbine)"/>
        <polygon points="0,0 18,4 0,2" fill="var(--eco-turbine)"/>
        <polygon points="0,0 -12,14 -2,2" fill="var(--eco-turbine)"/>
      </g>
    </g>
    <g class="turbine fast" transform="translate(760,86) scale(1.2)">
      <rect x="14.5" y="0" width="3" height="48" fill="var(--eco-turbine)"/>
      <g class="blade" transform="translate(16,0)">
        <polygon points="0,-18 2,-2 -2,-2" fill="var(--eco-turbine)"/>
        <polygon points="0,0 18,4 0,2" fill="var(--eco-turbine)"/>
        <polygon points="0,0 -12,14 -2,2" fill="var(--eco-turbine)"/>
      </g>
    </g>
    <g class="turbine" transform="translate(1030,98) scale(0.9)">
      <rect x="14.5" y="0" width="3" height="40" fill="var(--eco-turbine)"/>
      <g class="blade" transform="translate(16,0)">
        <polygon points="0,-18 2,-2 -2,-2" fill="var(--eco-turbine)"/>
        <polygon points="0,0 18,4 0,2" fill="var(--eco-turbine)"/>
        <polygon points="0,0 -12,14 -2,2" fill="var(--eco-turbine)"/>
      </g>
    </g>
  </svg>

  <!-- Back to top -->
  <button class="top-btn" id="topBtn" aria-label="Back to top">‚Üë Top</button>

  <!-- ADD ACTIVITY MODAL -->
  <dialog id="activityModal">
    <form method="dialog" class="modal">
      <header>
        <strong id="modalTitle">Add Activity</strong>
        <button class="btn-small" value="cancel" aria-label="Close">‚úï</button>
      </header>
      <div class="content">
        <div class="grid2">
          <div>
            <div class="field"><label for="title">Activity title</label><input id="title" required placeholder="e.g., Tidal Power Plant for Coastal Village"/></div>
            <div class="field"><label for="aim">AIM (1‚Äì2 lines)</label><textarea id="aim" placeholder="State the objective clearly (what you will design/prove)."></textarea></div>
            <div class="field"><label for="workflow">FLOW CHART ‚Äî steps (one per line)</label>
              <textarea id="workflow" placeholder="Resource Intake / Source
Pre-treatment / Control
Energy Conversion Unit
Power Conditioning / Storage
AC Bus / Loads"></textarea>
            </div>
          </div>
          <div>
            <div class="field"><label for="source">SOLUTION ‚Äî Source of energy (bullets)</label><textarea id="source" placeholder="‚Ä¢ What is the energy source?&#10;‚Ä¢ Where does it come from?"></textarea></div>
            <div class="field"><label for="conversion">SOLUTION ‚Äî Conversion process (numbered steps)</label><textarea id="conversion" placeholder="1) Input ‚Üí process step&#10;2) Conversion unit ‚Üí output&#10;3) Conditioning / control‚Ä¶"></textarea></div>
            <div class="field"><label for="output">SOLUTION ‚Äî Output / utilization (bullets)</label><textarea id="output" placeholder="‚Ä¢ Electricity / heat / water&#10;‚Ä¢ What gets powered?"></textarea></div>
            <div class="field"><label for="relevance">SOLUTION ‚Äî Real-world relevance (bullets)</label><textarea id="relevance" placeholder="‚Ä¢ Why this matters&#10;‚Ä¢ Benefits to users/community"></textarea></div>
            <div class="field"><label for="rwTitle">Real-World Case (title)</label><input id="rwTitle" placeholder="e.g., Baharbari Hybrid PV + Biomass Microgrid"/></div>
            <div class="field"><label for="rwUrl">Real-World Case (URL)</label><input id="rwUrl" placeholder="https://‚Ä¶"/></div>
            <div class="field"><label for="refs">References (one URL per line)</label><textarea id="refs" placeholder="https://‚Ä¶&#10;https://‚Ä¶"></textarea></div>
          </div>
        </div>
      </div>
      <footer>
        <button class="btn" value="cancel">Cancel</button>
        <button class="btn btn-accent" id="saveBtn" value="default">Save Activity</button>
      </footer>
    </form>
  </dialog>

<script>
/* ---------- Helpers ---------- */
const $ = sel => document.querySelector(sel);
const $$ = sel => [...document.querySelectorAll(sel)];
const setStamp = () => $("#lastUpdated").textContent = new Date().toLocaleDateString();
setStamp();

/* ---------- THEME ---------- */
const THEME_KEY = "ftiv_theme";
function applyTheme(theme){
  document.documentElement.setAttribute("data-theme", theme);
  $("#themeToggle").textContent = theme === "dark" ? "üåô Dark" : "üåû Light";
  localStorage.setItem(THEME_KEY, theme);
}
(function initTheme(){
  const saved = localStorage.getItem(THEME_KEY);
  if(saved){ applyTheme(saved); }
  else {
    const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    applyTheme(prefersDark ? "dark" : "light");
  }
})();
$("#themeToggle").addEventListener("click", ()=>{
  const curr = document.documentElement.getAttribute("data-theme");
  applyTheme(curr === "dark" ? "light" : "dark");
});

/* ---------- Data (AIM / real-world / refs included) ---------- */
const KEY = "ftiv_portfolio_activities_v4"; // keep from previous version

function loadActivities(){
  const raw = localStorage.getItem(KEY);
  if(raw){ try { return JSON.parse(raw); } catch{} }
  const seed = [
    {
      id:"a1",
      title:"Biogas + Wind for Rural Health Clinic",
      aim:"Design a reliable 24/7 hybrid (biogas + wind + battery) to power a rural health clinic‚Äôs critical loads with minimal diesel backup.",
      workflow:[
        "Parallel A ‚Äî Biogas: Feedstock Collection (kitchen waste, agri residue, toilets)",
        "Parallel A ‚Äî Biogas: Anaerobic Digester (biogas generation)",
        "Parallel A ‚Äî Biogas: Gas Cleaning (H‚ÇÇS scrubber + moisture trap)",
        "Parallel A ‚Äî Biogas: Gas Holder + Pressure Regulation",
        "Parallel A ‚Äî Biogas: Biogas Genset (AC)",
        "Parallel B ‚Äî Wind: Wind Turbine (5‚Äì20 kW class)",
        "Parallel B ‚Äî Wind: Charge Controller / Rectifier (to DC)",
        "Shared: Battery Bank (buffer + surge support)",
        "Shared: Inverter (DC‚ÜíAC; grid-forming)",
        "Smart Controller: SOC & load priority + Auto start/stop of genset",
        "Optional Fallback: Diesel via ATS (emergencies only)",
        "Merge ‚Üí AC Bus ‚Üí Clinic Critical Loads (lighting, vaccine fridge, autoclave, comms)"
      ],
      realworld:{ label:"Wind‚ÄìBiogas Hybrid for Remote Healthcare (research) + WHO guidance on clinic electricity", url:"https://www.mdpi.com/2071-1050/15/20/14935" },
      references:[
        {label:"WHO ‚Äî Electricity in health-care facilities (2023)", url:"https://www.who.int/news-room/fact-sheets/detail/electricity-in-health-care-facilities"},
        {label:"MDPI Sustainability ‚Äî Wind‚ÄìBiogas Hybrid for Remote Healthcare (2023)", url:"https://www.mdpi.com/2071-1050/15/20/14935"},
        {label:"NREL ‚Äî Renewable Energy for Rural Health Clinics (tech guide)", url:"https://docs.nrel.gov/docs/legosti/fy98/25233.pdf"}
      ],
      points:{
        source:[
          "Biogas from organics: kitchen waste, agri residue, latrine-linked digesters.",
          "Wind via small/medium turbine (‚âà5‚Äì20 kW) complementing night/seasonal resource."
        ],
        conversion:[
          "Feedstock ‚Üí oxygen-free digestion ‚Üí methane-rich biogas.",
          "Scrubber removes H‚ÇÇS & moisture ‚Üí protects engine and extends life.",
          "Biogas engine‚Äìgenerator makes AC; wind power is conditioned via controller.",
          "Battery buffers intermittency; inverter stabilizes voltage/frequency.",
          "Smart controller prioritizes medical loads and starts/stops genset based on SOC & demand.",
          "ATS enables rare emergency diesel fallback."
        ],
        output:[
          "24/7 reliable AC supply with surge handling for medical equipment.",
          "Supports lighting, cold chain, sterilization, communication/telemedicine."
        ],
        relevance:[
          "Cuts diesel cost/emissions and converts waste to value.",
          "Improves healthcare quality via dependable power; builds local O&M skills."
        ]
      }
    },
    {
      id:"a2",
      title:"Microgrid: Solar PV + Wind + Biomass",
      aim:"Propose a village-scale microgrid (‚âà50‚Äì250 kW) combining PV, wind and biomass for reliable power to critical, priority and deferrable loads.",
      workflow:[
        "Solar PV ‚Üí MPPT (to DC bus)",
        "Wind Turbine ‚Üí Rectifier/Controller (to DC bus)",
        "Common DC Bus (PV + Wind aggregated)",
        "Battery Storage (charge/discharge management)",
        "Bi-Directional Inverter (forms/stiffens AC microgrid)",
        "Protection & Synchronization (breakers, relays, anti-islanding)",
        "AC Microgrid (Critical / Priority / Deferrable loads)",
        "Biomass Chain: Fuel Prep (drying/sizing) ‚Üí Downdraft Gasifier",
        "Biomass Chain: Gas Cleaning/Filtration (tar/particulate removal)",
        "Biomass Genset (AC) ‚Üí Synchronized to AC Microgrid (firm capacity)",
        "EMS + Smart Meters (forecasting, dispatch, demand response, tariffs)"
      ],
      realworld:{ label:"Baharbari (India) Hybrid PV + Biomass Microgrid (case study)", url:"https://hybridpowersystems.org/Madeira2022/wp-content/uploads/sites/26/2022/11/3A_3_HYB22_048_presentation_Nandakumar_Avinash_TN.pdf" },
      references:[
        {label:"DESI Power ‚Äî Hybrid Microgrid Paper (India)", url:"https://www.desipower.com/downloads/Hybrid-Microgrid-Paper.pdf"},
        {label:"Baharbari Hybrid PV + Biomass (Workshop case)", url:"https://hybridpowersystems.org/Madeira2022/wp-content/uploads/sites/26/2022/11/3A_3_HYB22_048_presentation_Nandakumar_Avinash_TN.pdf"},
        {label:"RAEL UC Berkeley ‚Äî Microgrids for Rural Electrification", url:"https://rael.berkeley.edu/wp-content/uploads/2015/04/MicrogridsReportEDS.pdf"}
      ],
      points:{
        source:[
          "Daytime solar PV; wind complements at night/seasonally.",
          "Firm capacity from biomass (downdraft gasifier using crop residues/wood chips)."
        ],
        conversion:[
          "PV and wind are conditioned to a common DC bus (MPPT / rectifier).",
          "Battery smooths variability; bi-dir inverter forms a stable AC microgrid.",
          "Gasifier converts solid biomass ‚Üí producer gas ‚Üí IC engine genset (AC).",
          "Protection & sync ensure safe AC coupling; EMS schedules resources.",
          "Smart meters shift deferrable loads to high-renewable windows."
        ],
        output:[
          "Village-scale reliable electricity (~50‚Äì250 kW).",
          "Tiered supply: critical (clinic/school), priority (pumps/street lights), deferrable (processing/cold rooms)."
        ],
        relevance:[
          "Lowers diesel dependence and cost; improves supply resilience.",
          "Creates local jobs (biomass logistics, O&M) and enables productive uses."
        ]
      }
    },
    {
      id:"a3",
      title:"OTEC: Electricity + Freshwater",
      aim:"Develop an OTEC system (closed-cycle) that produces electricity and supports freshwater generation for coastal communities.",
      workflow:[
        "Warm Surface Seawater Intake (screening & intake pump)",
        "Deep Cold Seawater Pipe + Pump (‚âà700‚Äì1000 m depth)",
        "Evaporator (warm water heats low-boiling working fluid ‚Üí vapor)",
        "Turbine (vapor expansion ‚Üí mechanical power)",
        "Generator (mechanical ‚Üí electrical power)",
        "Condenser (cold deep seawater condenses working fluid)",
        "Working-Fluid Pump ‚Üí Evaporator (closed loop completed)",
        "Power Conditioning (transformer/inverter/protection) ‚Üí Grid/Loads",
        "Desalination Module (e.g., membrane distillation driven by OTEC gradients)",
        "Discharge/Return Lines (environmental mixing & compliance)",
        "Monitoring & Control (flow, temperatures, pressures, efficiency)"
      ],
      realworld:{ label:"Makai (Hawaii) 105 kW OTEC Demo + Okinawa OTEC Facility", url:"https://www.makai.com/renewable-energy/otec/" },
      references:[
        {label:"Makai ‚Äî 105 kW Grid-connected OTEC at NELHA (2015)", url:"https://www.makai.com/renewable-energy/otec/"},
        {label:"RenewableEnergyWorld ‚Äî U.S. grid-connected OTEC (2015)", url:"https://www.renewableenergyworld.com/solar/first-u-s-grid-connected-otec-plant-goes-live-on-hawaii/"},
        {label:"Okinawa OTEC Demonstration Facility", url:"https://otecokinawa.com/en/"}
      ],
      points:{
        source:[
          "Ocean temperature gradient: warm surface ‚âà25‚Äì30 ¬∞C vs. cold deep ‚âà4‚Äì8 ¬∞C (tropics)."
        ],
        conversion:[
          "Warm water heats a low-boiling working fluid (e.g., ammonia) ‚Üí vapor.",
          "Vapor spins turbine; generator makes electricity.",
          "Cold deep water condenses vapor; pump recirculates working fluid.",
          "Low ŒîT needs large heat exchangers and continuous flows."
        ],
        output:[
          "Steady baseload electricity independent of daily weather.",
          "Freshwater via desalination; potential mariculture using nutrient-rich deep water."
        ],
        relevance:[
          "Useful for islands/coasts with high fuel import costs and water scarcity.",
          "Supports resilience, tourism infrastructure, and lower carbon intensity."
        ]
      }
    }
  ];
  saveActivities(seed);
  return seed;
}
function saveActivities(arr){ localStorage.setItem(KEY, JSON.stringify(arr)); setStamp(); }

let activities = loadActivities();

/* ---------- Render ---------- */
function renderSidebar(){
  const nav = $("#menu"); nav.innerHTML = "";
  const dash = document.createElement("a"); dash.href="#dashboard"; dash.textContent="üè† Dashboard"; nav.appendChild(dash);
  activities.forEach((a,i)=>{
    const link = document.createElement("a");
    link.href = `#${a.id}`;
    link.textContent = `Activity ${i+1} ‚Äî ${a.title}`;
    nav.appendChild(link);
  });
}
function renderDashboard(){
  $("#kpis").innerHTML = `
    <div class="kpi"><b>Total activities</b><div style="font-size:28px;margin-top:4px">${activities.length}</div></div>
    <div class="kpi"><b>With flow charts</b><div style="font-size:28px;margin-top:4px">${activities.filter(a=>a.workflow?.length).length}</div></div>
    <div class="kpi"><b>Last updated</b><div style="font-size:28px;margin-top:4px">${new Date().toLocaleString()}</div></div>
  `;
  const cards = $("#cards"); cards.innerHTML = "";
  activities.forEach((a,i)=>{
    const el = document.createElement("div");
    el.className = "card-mini";
    el.innerHTML = `
      <div style="display:flex;justify-content:space-between;gap:10px;align-items:start">
        <div>
          <div style="font-weight:650">${i+1}. ${a.title}</div>
          <div class="row" style="margin-top:6px">
            <span class="tag">Blocks: ${a.workflow.length}</span>
            <span class="tag">AIM ready</span>
            <span class="tag">Refs: ${a.references?.length||0}</span>
          </div>
        </div>
        <div class="row">
          <a class="btn-small" href="#${a.id}">Open</a>
        </div>
      </div>
    `;
    cards.appendChild(el);
  });
}
function renderActivities(){
  const container = $("#activities"); container.innerHTML="";
  activities.forEach((a,i)=>{
    const sec = document.createElement("section");
    sec.className = "card hidden"; sec.id = a.id;
    sec.setAttribute("aria-labelledby",`title-${a.id}`);
    sec.innerHTML = `
      <h3 id="title-${a.id}">Activity ${i+1} ‚Äî ${a.title}</h3>
      <div class="grid">
        <div class="diagram" id="diagram-${a.id}" aria-label="Flow chart"></div>
        <div class="explain">
          ${renderAIM(a.aim)}
          ${renderSolution(a.points, a.realworld, a.references)}
        </div>
      </div>
      <div style="margin-top:10px">
        <a class="btn-small" href="#dashboard">‚Üê Back to Dashboard</a>
      </div>
    `;
    container.appendChild(sec);
    drawVerticalDiagram(`#diagram-${a.id}`, a.workflow);
  });
}
function renderAIM(aim){
  const esc = s => (s??"").toString().replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");
  return `
    <h4>üü¢ AIM</h4>
    <p style="margin:6px 0 10px">${esc(aim || "‚Äî")}</p>
    <h4>üß≠ FLOW CHART</h4>
    <p class="lead" style="margin:6px 0 12px">See the vertical blocks on the left.</p>
  `;
}
function renderSolution(p, realworld, refs){
  const esc = s => (s??"").toString().replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");
  const rl = realworld?.url ? `<a href="${realworld.url}" target="_blank" rel="noopener">${esc(realworld.label||realworld.url)}</a>` : "‚Äî";
  const refList = (refs||[]).map(r=>`<li><a href="${r.url}" target="_blank" rel="noopener">${esc(r.label||r.url)}</a></li>`).join("");
  return `
    <h4>üß© SOLUTION</h4>
    <h4>Source of energy</h4>
    <ul>${(p.source||[]).map(li=>`<li>${esc(li)}</li>`).join("")}</ul>
    <h4>Conversion process (step-by-step)</h4>
    <ol>${(p.conversion||[]).map(li=>`<li>${esc(li)}</li>`).join("")}</ol>
    <h4>Output / utilization</h4>
    <ul>${(p.output||[]).map(li=>`<li>${esc(li)}</li>`).join("")}</ul>
    <h4>Real-world relevance</h4>
    <ul>${(p.relevance||[]).map(li=>`<li>${esc(li)}</li>`).join("")}</ul>
    <h4>üåç Real-World Case</h4>
    <p>${rl}</p>
    <h4>üìö References</h4>
    <ul>${refList || "<li>‚Äî</li>"}</ul>
  `;
}

/* ---------- SVG: vertical flow chart (Clean & Green) ---------- */
function drawVerticalDiagram(sel, steps=[]){
  const host = document.querySelector(sel);
  const h = 64, gap = 20, padX = 40, w = 560, startY = 20;
  const totalH = startY + steps.length*(h+gap) + 10;
  const svgNS = "http://www.w3.org/2000/svg";
  const svg = document.createElementNS(svgNS,"svg");
  svg.setAttribute("width","100%"); svg.setAttribute("height", Math.max(320,totalH));
  svg.setAttribute("viewBox",`0 0 640 ${Math.max(320,totalH)}`);

  const defs = document.createElementNS(svgNS,"defs");
  defs.innerHTML = `
    <style>
      .box{fill:var(--svg-box);stroke:var(--svg-stroke);stroke-width:2;rx:12;ry:12}
      .txt{font:14px/1.3 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;fill:var(--svg-text)}
      .lane{stroke:var(--svg-lane);stroke-width:2;stroke-dasharray:6 6}
      .arr{stroke:var(--svg-arrow);stroke-width:2;marker-end:url(#arr)}
    </style>
    <marker id="arr" markerWidth="10" markerHeight="8" refX="9" refY="4" orient="auto">
      <polygon points="0 0,10 4,0 8" fill="var(--svg-arrow)"></polygon>
    </marker>`;
  svg.appendChild(defs);

  const lane = document.createElementNS(svgNS,"line");
  lane.setAttribute("x1", (w/2)); lane.setAttribute("x2", (w/2));
  lane.setAttribute("y1", 10); lane.setAttribute("y2", Math.max(320,totalH)-10);
  lane.setAttribute("class","lane");
  svg.appendChild(lane);

  steps.forEach((label,i)=>{
    const y = startY + i*(h+gap);
    const rect = document.createElementNS(svgNS,"rect");
    rect.setAttribute("x", (w/2 - (w-2*padX)/2));
    rect.setAttribute("y", y);
    rect.setAttribute("width", (w-2*padX));
    rect.setAttribute("height", h);
    rect.setAttribute("class","box");
    svg.appendChild(rect);

    const text = document.createElementNS(svgNS,"text");
    text.setAttribute("x", w/2); text.setAttribute("y", y + h/2 + 5);
    text.setAttribute("text-anchor","middle"); text.setAttribute("class","txt");
    text.textContent = label;
    svg.appendChild(text);

    if(i < steps.length-1){
      const line = document.createElementNS(svgNS,"line");
      line.setAttribute("x1", w/2); line.setAttribute("x2", w/2);
      line.setAttribute("y1", y + h); line.setAttribute("y2", y + h + gap);
      line.setAttribute("class","arr");
      svg.appendChild(line);
    }
  });

  host.innerHTML = ""; host.appendChild(svg);
}

/* ---------- View: only one visible ---------- */
function setActiveLink(hash){
  $$("#menu a").forEach(a => a.classList.toggle("active", a.getAttribute("href") === hash));
}
function showOnly(id){
  $("#dashboard").classList.add("hidden");
  $$("#activities > section").forEach(s => s.classList.add("hidden"));
  if(id === "dashboard" || !id){
    $("#dashboard").classList.remove("hidden");
    setActiveLink("#dashboard");
  }else{
    const el = document.getElementById(id);
    if(el){ el.classList.remove("hidden"); el.scrollIntoView({behavior:"smooth", block:"start"}); }
    setActiveLink("#"+id);
  }
}
window.addEventListener("hashchange", ()=>{
  const id = location.hash.replace("#","");
  showOnly(id || "dashboard");
});

/* ---------- Add Activity (modal) ---------- */
const dlg = $("#activityModal");
$("#openAddDash").addEventListener("click", ()=> openAdd());
$("#openAddSide").addEventListener("click", ()=> openAdd());

function openAdd(){
  $("#modalTitle").textContent = "Add Activity";
  ["title","aim","workflow","source","conversion","output","relevance","rwTitle","rwUrl","refs"].forEach(id=>{ $("#"+id).value = ""; });
  dlg.showModal();
}
$("#saveBtn").addEventListener("click", (e)=>{
  e.preventDefault();
  const title = $("#title").value.trim();
  if(!title){ alert("Please enter a title"); return; }
  const wf = $("#workflow").value.split("\n").map(s=>s.trim()).filter(Boolean);
  const toLines = t => t.split("\n").map(s=>s.replace(/^(\u2022|\-|\d+[.)])\s*/,"").trim()).filter(Boolean);
  const refs = $("#refs").value.split("\n").map(s=>s.trim()).filter(Boolean).map(u=>({label:u,url:u}));
  const obj = {
    id: 'id-' + Math.random().toString(36).slice(2,9),
    title,
    aim: $("#aim").value.trim(),
    workflow: wf.length? wf : ["Problem Definition","Inputs / Data","Process / Method","Output","Verification"],
    realworld: { label: $("#rwTitle").value.trim(), url: $("#rwUrl").value.trim() },
    references: refs,
    points:{
      source: toLines($("#source").value),
      conversion: toLines($("#conversion").value),
      output: toLines($("#output").value),
      relevance: toLines($("#relevance").value)
    }
  };
  activities.push(obj); saveActivities(activities);
  dlg.close();
  renderSidebar(); renderDashboard(); renderActivities();
  location.hash = `#${obj.id}`;
});

/* ---------- Nav & UX ---------- */
const toggleBtn = document.querySelector('.menu-toggle');
const menu = document.getElementById('menu');
toggleBtn.addEventListener('click', () => {
  const collapsed = menu.classList.toggle('collapsed');
  toggleBtn.setAttribute('aria-expanded', String(!collapsed));
});
const topBtn = $("#topBtn");
const onScroll = () => topBtn.classList.toggle('show', window.scrollY > 400);
window.addEventListener('scroll', onScroll, {passive:true});
topBtn.addEventListener('click', () => window.scrollTo({top:0, behavior:'smooth'}));

/* ---------- Init ---------- */
function init(){
  renderSidebar();
  renderDashboard();
  renderActivities();
  showOnly((location.hash||"#dashboard").replace("#",""));
}
window.addEventListener('load', init);
</script>
</body>
</html>
